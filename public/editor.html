<!DOCTYPE html>
<html lang="en" x-data="editorApp()">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VIBEâ“ˆ Universal Visual Builder</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- AlpineJS -->
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>

  <!-- SortableJS -->
  <script defer src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>

  <!-- Link to backend config -->
  <script type="module">
    import { CONFIG } from "./config.js";
    window.CONFIG = CONFIG;
  </script>

  <style>
    .drag-handle { cursor: move; }
    .component:hover { outline: 2px solid #60a5fa; }
    [contenteditable]:focus { outline: 2px solid #3b82f6; border-radius: 6px; }
  </style>
</head>

<body class="bg-gray-900 text-white min-h-screen flex">

  <!-- LEFT PANE (Dark Builder UI) -->
  <div class="w-1/3 bg-gray-950 p-6 space-y-6 border-r border-gray-800">

    <h1 class="text-2xl font-bold mb-6">
      âœ¨ VIBEâ“ˆ Visual Builder
    </h1>

    <!-- Project Name -->
    <div class="space-y-2">
      <label class="text-xs text-gray-400">Project Name</label>
      <input x-model="projectName" class="w-full px-3 py-2 bg-gray-800 rounded" />
    </div>

    <!-- Add Components -->
    <div class="grid grid-cols-2 gap-3">
      <button @click="add('hero')" class="px-4 py-2 bg-blue-600 rounded">+ Hero</button>
      <button @click="add('text')" class="px-4 py-2 bg-gray-700 rounded">+ Text</button>
      <button @click="add('buttonGrid')" class="px-4 py-2 bg-green-600 rounded">+ Buttons</button>
      <button @click="add('image')" class="px-4 py-2 bg-purple-600 rounded">+ Image</button>
      <button @click="add('form')" class="px-4 py-2 bg-orange-600 rounded">+ Form</button>
      <button @click="save()" class="px-4 py-2 bg-emerald-600 rounded">ðŸ’¾ Save</button>
    </div>

    <!-- Components List (Reorderable) -->
    <div class="space-y-4" x-ref="builder">
      <template x-for="(comp, i) in components" :key="i">
        <div class="p-4 bg-gray-800 rounded component relative group">

          <div class="drag-handle absolute right-2 top-2 text-blue-400 opacity-0 group-hover:opacity-100">â‰¡</div>
          <div class="absolute left-2 top-2 text-red-400 opacity-0 group-hover:opacity-100 cursor-pointer"
              @click="remove(i)">âœ•</div>

          <div class="text-xs text-gray-400 uppercase mb-2">
            <span x-text="comp.type"></span>
          </div>

          <!-- HERO -->
          <template x-if="comp.type === 'hero'">
            <div>
              <div contenteditable @blur="update(i,'title',$event.target.innerText)"
                   class="text-xl font-bold" x-text="comp.title"></div>
              <div contenteditable @blur="update(i,'subtitle',$event.target.innerText)"
                   class="text-sm text-gray-400 mt-2" x-text="comp.subtitle"></div>
            </div>
          </template>

          <!-- TEXT -->
          <template x-if="comp.type === 'text'">
            <div contenteditable @blur="update(i,'content',$event.target.innerText)"
                 class="text-sm leading-relaxed" x-text="comp.content"></div>
          </template>

          <!-- BUTTON GRID -->
          <template x-if="comp.type === 'buttonGrid'">
            <div class="space-y-2">
              <template x-for="(btn, bi) in comp.buttons">
                <div class="flex space-x-2">
                  <input x-model="comp.buttons[bi].text" class="flex-1 px-2 py-1 bg-gray-700 rounded text-xs" />
                  <input x-model="comp.buttons[bi].url" class="flex-1 px-2 py-1 bg-gray-700 rounded text-xs" />
                  <button @click="comp.buttons.splice(bi,1)" class="text-red-400 text-sm">âœ•</button>
                </div>
              </template>
              <button @click="comp.buttons.push({text:'New Button',url:'#'})"
                      class="text-blue-400 text-xs">+ Add Button</button>
            </div>
          </template>

          <!-- IMAGE -->
          <template x-if="comp.type === 'image'">
            <div>
              <input x-model="comp.src" class="w-full px-2 py-1 bg-gray-700 rounded text-xs mb-2" />
              <img :src="comp.src" class="w-full rounded opacity-75" />
            </div>
          </template>

          <!-- FORM -->
          <template x-if="comp.type === 'form'">
            <div>
              <template x-for="(field, fi) in comp.fields">
                <div class="flex space-x-2 mb-2">
                  <input x-model="field.label" class="flex-1 px-2 py-1 bg-gray-700 rounded text-xs" />
                  <input x-model="field.type" class="w-20 px-2 py-1 bg-gray-700 rounded text-xs" />
                  <button @click="comp.fields.splice(fi,1)" class="text-red-400 text-sm">âœ•</button>
                </div>
              </template>
              <button @click="comp.fields.push({label:'Field',type:'text'})"
                      class="text-blue-400 text-xs">+ Add Field</button>
            </div>
          </template>

        </div>
      </template>
    </div>

  </div>


  <!-- RIGHT PANE (Light Preview UI) -->
  <div class="w-2/3 bg-gray-100 text-black p-6 overflow-y-auto">
    <div class="max-w-3xl mx-auto space-y-10">

      <template x-for="comp in components">
        <div>

          <!-- HERO PREVIEW -->
          <template x-if="comp.type === 'hero'">
            <div class="text-center py-10">
              <h1 class="text-4xl font-bold" x-text="comp.title"></h1>
              <p class="mt-4 text-gray-600 text-lg" x-text="comp.subtitle"></p>
            </div>
          </template>

          <!-- TEXT PREVIEW -->
          <template x-if="comp.type === 'text'">
            <p class="text-lg leading-relaxed" x-text="comp.content"></p>
          </template>

          <!-- BUTTON GRID PREVIEW -->
          <template x-if="comp.type === 'buttonGrid'">
            <div class="grid grid-cols-2 gap-4">
              <template x-for="btn in comp.buttons">
                <a :href="btn.url"
                   class="block text-center py-3 bg-blue-600 text-white rounded shadow hover:bg-blue-700 transition">
                  <span x-text="btn.text"></span>
                </a>
              </template>
            </div>
          </template>

          <!-- IMAGE PREVIEW -->
          <template x-if="comp.type === 'image'">
            <img :src="comp.src" class="w-full rounded shadow" />
          </template>

          <!-- FORM PREVIEW -->
          <template x-if="comp.type === 'form'">
            <form class="space-y-4">
              <template x-for="field in comp.fields">
                <input :type="field.type" :placeholder="field.label"
                       class="w-full px-4 py-3 border rounded" />
              </template>
              <button class="w-full py-3 bg-green-600 text-white rounded">Submit</button>
            </form>
          </template>

        </div>
      </template>

    </div>
  </div>


<script>
function editorApp() {
  return {
    projectName: "Untitled Project",
    components: [],

    add(type) {
      const templates = {
        hero: {type:'hero',title:'Your Title',subtitle:'Your subtitle'},
        text: {type:'text',content:'Editable text...'},
        buttonGrid: {type:'buttonGrid',buttons:[{text:'Button',url:'#'}]},
        image: {type:'image',src:'https://via.placeholder.com/800x400'},
        form: {type:'form',fields:[{label:'Name',type:'text'}]}
      };
      this.components.push(templates[type]);
      this.save();
    },

    update(i, field, value) {
      this.components[i][field] = value;
      this.save();
    },

    remove(i) {
      this.components.splice(i, 1);
      this.save();
    },

    async save() {
      await fetch(`${CONFIG.BACKEND_URL}/save-project`, {
        method: "POST",
        headers: {"Content-Type":"application/json"},
        body: JSON.stringify({
          projectId: "default",
          name: this.projectName,
          components: this.components
        })
      });
    },

    init() {
      fetch(`${CONFIG.BACKEND_URL}/get-project/default`)
        .then(r => r.json())
        .then(data => {
          if (data.components) {
            this.components = data.components;
            this.projectName = data.name;
          }
        });

      new Sortable(this.$refs.builder, {
        handle: ".drag-handle",
        animation: 150,
        onEnd: () => this.save()
      });
    }
  }
}
</script>

</body>
</html>
