<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>VIBEⓈ Live HTML Preview</title>

  <!-- Tailwind for the editor UI itself -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    textarea {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      tab-size: 2;
    }
    body {
      background: #020617;
    }
  </style>
</head>
<body class="min-h-screen text-slate-100">

  <div class="h-screen flex flex-col">
    <!-- Top bar -->
    <header class="flex items-center justify-between px-4 py-3 border-b border-slate-800 bg-slate-950">
      <div class="flex items-center gap-2">
        <span class="text-amber-400 text-xl">✨</span>
        <div>
          <h1 class="text-sm font-semibold leading-tight">VIBEⓈ Live HTML Preview</h1>
          <p class="text-[11px] text-slate-400">Paste HTML · Tailwind preview · tweak visually · copy back to GitHub</p>
        </div>
      </div>

      <!-- Layout controls -->
      <div class="flex flex-wrap items-center gap-3 text-[11px]">
        <div class="flex items-center gap-1">
          <span class="text-slate-400">Width</span>
          <select id="widthSelect" class="bg-slate-900 border border-slate-700 rounded px-2 py-1">
            <option value="max-w-xl">Narrow</option>
            <option value="max-w-3xl" selected>Medium</option>
            <option value="max-w-5xl">Wide</option>
            <option value="max-w-none">Full</option>
          </select>
        </div>

        <div class="flex items-center gap-1">
          <span class="text-slate-400">Padding</span>
          <select id="paddingSelect" class="bg-slate-900 border border-slate-700 rounded px-2 py-1">
            <option value="p-0">0</option>
            <option value="p-6" selected>Medium</option>
            <option value="p-10">Large</option>
          </select>
        </div>

        <label class="inline-flex items-center gap-1 cursor-pointer">
          <input id="gridToggle" type="checkbox" class="rounded border-slate-600 bg-slate-900">
          <span class="text-slate-400">Alignment grid</span>
        </label>
      </div>
    </header>

    <!-- Main content: editor + preview -->
    <main class="flex-1 grid grid-cols-1 lg:grid-cols-2 gap-0">
      <!-- LEFT: HTML editor -->
      <section class="border-r border-slate-800 bg-slate-950 flex flex-col">
        <div class="px-3 py-2 border-b border-slate-800 flex items-center justify-between">
          <span class="text-[11px] font-semibold text-slate-300 uppercase tracking-wide">HTML Source</span>
          <span class="text-[11px] text-slate-500">Edit here → preview updates on the right</span>
        </div>
        <textarea
          id="htmlInput"
          class="flex-1 w-full bg-slate-950 text-slate-100 text-[12px] leading-relaxed p-3 outline-none resize-none"
          spellcheck="false"></textarea>
      </section>

      <!-- RIGHT: Live preview (iframe) -->
      <section class="bg-slate-900 flex flex-col">
        <div class="px-3 py-2 border-b border-slate-800 flex items-center justify-between">
          <span class="text-[11px] font-semibold text-slate-300 uppercase tracking-wide">Live Preview</span>
          <span class="text-[11px] text-slate-500">Rendered with Tailwind CDN</span>
        </div>
        <iframe
          id="previewFrame"
          class="flex-1 w-full bg-white"
          sandbox="allow-same-origin allow-scripts allow-forms allow-popups"
        ></iframe>
      </section>
    </main>
  </div>

  <script>
    // Simple debounce so we don't re-render on every single keystroke
    function debounce(fn, delay) {
      let t;
      return function () {
        const args = arguments;
        clearTimeout(t);
        t = setTimeout(() => fn.apply(null, args), delay);
      };
    }

    const htmlInput = document.getElementById("htmlInput");
    const previewFrame = document.getElementById("previewFrame");
    const widthSelect = document.getElementById("widthSelect");
    const paddingSelect = document.getElementById("paddingSelect");
    const gridToggle = document.getElementById("gridToggle");

    // Starter content so it's not empty
    const starterHtml = `<!-- Paste ANY HTML snippet here.
You do NOT need <html> or <body> tags — this will be wrapped for you.

Example: -->

<section class="bg-white rounded-xl shadow p-8 space-y-4">
  <h1 class="text-3xl font-bold tracking-tight text-slate-900">
    Your Title
  </h1>
  <p class="text-slate-600">
    This is a live Tailwind preview. Adjust classes, spacing, and layout here,
    then copy the HTML back into your GitHub file.
  </p>

  <div class="flex flex-wrap gap-3">
    <a href="#" class="px-4 py-2 rounded-lg bg-emerald-600 text-white text-sm font-semibold">
      Primary action
    </a>
    <a href="#" class="px-4 py-2 rounded-lg border border-slate-300 text-slate-700 text-sm font-medium">
      Secondary
    </a>
  </div>
</section>`;

    htmlInput.value = starterHtml;

    function buildPreviewHtml() {
      const userHtml = htmlInput.value || "";

      const widthClass = widthSelect.value || "max-w-3xl";
      const paddingClass = paddingSelect.value || "p-6";
      const gridOn = gridToggle.checked;

      const gridCss = gridOn
        ? `
      body::before {
        content: "";
        position: fixed;
        inset: 0;
        pointer-events: none;
        background-image:
          linear-gradient(to right, rgba(148,163,184,0.18) 1px, transparent 1px),
          linear-gradient(to bottom, rgba(148,163,184,0.18) 1px, transparent 1px);
        background-size: 40px 40px;
        z-index: 0;
      }`
        : "";

      // Full HTML document that will run inside the iframe
      return `
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Preview</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { background: #e5e7eb; }
    ${gridCss}
  </style>
</head>
<body>
  <div class="min-h-screen flex justify-center">
    <div class="${widthClass} ${paddingClass} w-full relative z-10">
${userHtml}
    </div>
  </div>
</body>
</html>
      `.trim();
    }

    const render = debounce(function () {
      const doc = buildPreviewHtml();
      previewFrame.srcdoc = doc;
      // Save last code locally so it persists
      try {
        localStorage.setItem("vibe_live_editor_html", htmlInput.value);
      } catch (e) {}
    }, 200);

    // Restore last session if available
    try {
      const saved = localStorage.getItem("vibe_live_editor_html");
      if (saved) htmlInput.value = saved;
    } catch (e) {}

    htmlInput.addEventListener("input", render);
    widthSelect.addEventListener("change", render);
    paddingSelect.addEventListener("change", render);
    gridToggle.addEventListener("change", render);

    // Initial render
    render();
  </script>
</body>
</html>
